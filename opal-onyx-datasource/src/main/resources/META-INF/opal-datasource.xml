<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd 
  http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">
  
  <import resource="onyx-data-input.xml"/>

  <bean id="qnameStrategy" class="org.obiba.opal.datasource.onyx.variable.DefaultVariableQNameStrategy">
    <constructor-arg value="${org.obiba.opal.study.baseUri}/onyx"/>
    <constructor-arg>
      <bean class="org.obiba.onyx.engine.variable.impl.DefaultVariablePathNamingStrategy">
        <property name="pathSeparator" value="${org.obiba.onyx.pathSeparator}"/>
      </bean>
    </constructor-arg>
  </bean>

  <bean id="elmoManagerFactory" class="org.obiba.opal.elmo.SesameManagerFactoryBean">
    <property name="repository">
      <bean factory-bean="opalRepositoryManager" factory-method="getDataRepository" />
    </property>
    <property name="inferencingEnabled" value="true"/>
  </bean>

  <bean id="onyxImportService" class="org.obiba.opal.datasource.onyx.service.impl.DefaultOnyxImportServiceImpl">
    <property name="participantKeyWriteRegistry" ref="participantKeyRegistry" />
    <property name="participantKeyReadRegistry" ref="participantKeyRegistry" />
    <property name="dataInputStrategy" ref="onyxDataInputStrategy" />
    <property name="importConfiguration" value="classpath:onyx-import.xml" />

    <property name="variableVisitor">
      <bean class="org.obiba.opal.datasource.onyx.elmo.ElmoVariableVisitor">
        <constructor-arg ref="qnameStrategy" />
        <constructor-arg ref="elmoManagerFactory" />
      </bean>
    </property>
    <property name="variableDataVisitor">
      <bean class="org.obiba.opal.datasource.onyx.elmo.ElmoVariableDataVisitor">
        <constructor-arg ref="qnameStrategy" />
        <constructor-arg ref="elmoManagerFactory" />
      </bean>
    </property>
  </bean>

</beans>
