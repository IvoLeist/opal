<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">

  <import resource="datasource.xml" />
  
    <bean id="hibernatePropertiesConfig" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
    <property name="properties">
      <props>
        <prop key="hibernate.generate_statistics">true</prop>
        <prop key="hibernate.cache.use_structured_entries">true</prop>
        <prop key="hibernate.cache.use_query_cache">true</prop>
        <prop key="hibernate.cache.provider_class">org.hibernate.cache.EhCacheProvider</prop>
        <prop key="hibernate.hbm2ddl.auto">update</prop>
      </props>
    </property>
  </bean>

  <bean id="hibernateConfig" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
    <property name="propertiesArray">
      <list>
        <ref bean="hibernatePropertiesConfig" />
        <ref bean="hibernateDbConfig" />
      </list>
    </property>
  </bean>
  
    <!-- Use a friendlier NamingStrategy -->
  <bean id="namingStrategy" class="org.hibernate.cfg.ImprovedNamingStrategy" />

  <!-- The Hibernate SessionFactory -->
  <bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
    <property name="dataSource">
      <ref bean="xaDataSource" />
    </property>
    <property name="namingStrategy">
      <ref bean="namingStrategy" />
    </property>
    <property name="annotatedClasses">
      <ref bean="annotatedEntityClasses" />
    </property>
    <property name="configurationClass" value="org.hibernate.cfg.AnnotationConfiguration" />
    <property name="hibernateProperties" ref="hibernateConfig" />
  </bean>

  <bean id="annotatedEntityClasses" class="org.obiba.onyx.spring.AnnotatedBeanFinderFactoryBean">
    <!-- Use Apache Ant Pattern -->
    <property name="searchPatterns">
      <set>
        <value>classpath*:org/obiba/opal/**/*.class</value>
        <!-- If you contributed a module that has its own persisted classes, add them here -->
      </set>
    </property>
    <!-- Specify annotations to look for in classes -->
    <property name="annotationClasses">
      <set>
        <value>javax.persistence.Entity</value>
        <value>javax.persistence.Embeddable</value>
        <value>javax.persistence.MappedSuperclass</value>
      </set>
    </property>
  </bean>

  <bean id="persistenceManager" class="org.obiba.core.service.impl.hibernate.PersistenceManagerHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
  </bean>

  <tx:annotation-driven transaction-manager="transactionManager" />

  <bean id="participantService"
    class="org.obiba.opal.core.service.impl.hibernate.ParticipantServiceHibernateImpl" scope="singleton">
    <property name="sessionFactory" ref="sessionFactory" />
    <property name="persistenceManager" ref="persistenceManager" />
  </bean>
  

  
  
</beans>