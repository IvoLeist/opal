<org.obiba.opal.core.cfg.OpalConfiguration>

  <secretKey>this will be generated during install</secretKey>

  <fileSystemRoot>file://${OPAL_HOME}/fs</fileSystemRoot>

  <functionalUnits>
  </functionalUnits>

  <magmaEngineFactory>

    <extensions>
      <org.obiba.magma.js.MagmaJsExtension />
      <org.obiba.magma.xstream.MagmaXStreamExtension />
      <org.obiba.magma.security.MagmaSecurityExtension />
    </extensions>

    <factories>
      <org.obiba.magma.datasource.hibernate.support.HibernateDatasourceFactory>
        <name>opal-data</name>
        <sessionFactoryProvider class="org.obiba.magma.datasource.hibernate.support.SpringBeanSessionFactoryProvider">
          <beanName>opalSessionFactory</beanName>
        </sessionFactoryProvider>
      </org.obiba.magma.datasource.hibernate.support.HibernateDatasourceFactory>
    </factories>
  </magmaEngineFactory>

  <extensions>
    <org.obiba.opal.datashield.cfg.DatashieldConfiguration>
      <aggregatingMethods>
      
        <org.obiba.opal.datashield.RFunctionDataShieldMethod>
          <name>length</name>
          <function>base::length</function>
        </org.obiba.opal.datashield.RFunctionDataShieldMethod>
        
        <org.obiba.opal.datashield.RFunctionDataShieldMethod>
          <name>coefficients</name>
          <function>coefficients</function>
        </org.obiba.opal.datashield.RFunctionDataShieldMethod>
        
        <org.obiba.opal.datashield.CustomRScriptMethod>
          <name>summary</name>
          <script><![CDATA[function(data) {
  if(is.vector(data)) {
    if(length(data) == 1) {
      "Vector too small."
    } else {
      base::summary(data);
    }
  }
} ]]>
</script>
        </org.obiba.opal.datashield.CustomRScriptMethod>
        
        <org.obiba.opal.datashield.CustomRScriptMethod>
          <name>lm.ds</name>
          <script><![CDATA[function(data) {
  if(inherits(data, 'lm')) {
   sum.lm <- stats::summary.lm(data)
   list(
     coefficients=sum.lm$coefficients,
     numsubs=length(sum.lm$residuals)
   )
 } else {
  NULL
 }
}]]></script>
        </org.obiba.opal.datashield.CustomRScriptMethod>
        
        <org.obiba.opal.datashield.CustomRScriptMethod>
          <name>glm.ds</name>
          <script><![CDATA[function (mod.glm.ds) {

  X.mat<-as.matrix(mod.glm.ds$x)
  numsubs<-dim(X.mat)[1]

  y.vect<-as.vector(mod.glm.ds$y)

  lp.vect<-X.mat%*%mod.glm.ds$beta.vect

  if(mod.glm.ds$family$family=="binomial")
  {
    mu.vect<-exp(lp.vect)/(1+exp(lp.vect))
    var.vect<-(mu.vect*(1-mu.vect))
    g2.vect<-(1/(mu.vect*(1-mu.vect)))^2
    W.mat<-diag(as.vector(1/(var.vect*g2.vect)))
    log.L<-sum(y.vect*log(mu.vect) + (1-y.vect)*log(1-mu.vect))
    dev<- -2*log.L
  }

  info.matrix<-t(X.mat)%*%W.mat%*%X.mat
  u.vect<-(y.vect-mu.vect)*1/var.vect
  score.vect<-t(X.mat)%*%W.mat%*%u.vect

  list(info.matrix=info.matrix, score.vect=score.vect, numsubs=numsubs, dev=dev)
}
]]></script>
        </org.obiba.opal.datashield.CustomRScriptMethod>
        
      </aggregatingMethods>
    </org.obiba.opal.datashield.cfg.DatashieldConfiguration>
  </extensions>
</org.obiba.opal.core.cfg.OpalConfiguration>